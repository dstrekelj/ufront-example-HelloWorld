<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../bootstrap.min.js"></script><link href="../../styles.css" rel="stylesheet" /><link rel="icon" href="../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../nav.js"></script><script type="text/javascript" src="../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../",platforms: ["project"]};</script><title>ManyToMany</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="project"><a href="#">project</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><h1><code><span class="directive">class </span><span class="type">ufront.db.ManyToMany</span>&lt;<span class="type">A</span>, <span class="type">B</span>&gt;</code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div class="doc"><p>An object used to join two tables/models with a Many-to-Many relationship.</p>
<p>A ManyToMany relationship is one where two models are joined but there's no obvious <code><a href="../../ufront/db/BelongsTo.html">BelongsTo</a></code> relationship - each object can be related to many others on each side.</p>
<p>Examples include:</p><ul><li>Blog Posts and Tags (each blog post can have many tags, each tag can have many blog posts)</li><li>Users and Groups (each user can have many groups, each group can have many users)</li><li>Projects and Staff (each project can have many staff assigned to it, each staff member could be assigned to one or more projects)</li><li>Students and Classes, etc.</li></ul>
<p>The join table follows the <code><a href="../../ufront/db/Relationship.html">Relationship</a></code> schema, but uses a different name for each join type.
The naming convention for join tables is <code>_join_$firstClass_$secondClass</code> where the class names are sorted alphabetically.</p>
<p>A current limitation is that you can only have one ManyToMany join table between each combination of models.
For example, you cannot have two properties <code>teachers:<a href="../../ufront/db/ManyToMany.html">ManyToMany</a>&lt;Teacher,<a href="../../Class.html">Class</a>&gt;</code> and <code>assistantTeachers:<a href="../../ufront/db/ManyToMany.html">ManyToMany</a>&lt;Teacher,<a href="../../Class.html">Class</a>&gt;</code> - they will both use the same join table.</p>
<p>The <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> class has some static helpers for:</p><ul><li><code><a href="../../ufront/db/ManyToMany.html#generateTableName">ManyToMany.generateTableName</a></code> Generating a join table name from two classes</li><li><code><a href="../../ufront/db/ManyToMany.html#createJoinTable">ManyToMany.createJoinTable</a></code> Creating the join table in the database, if it does not exist</li><li><code><a href="../../ufront/db/ManyToMany.html#relatedIDsforObjects">ManyToMany.relatedIDsforObjects</a></code> Getting the related IDs for a particular set of object</li></ul>
<p>The <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> object is used to find the related IDs for a particular object:</p>
<pre><code>var joins = new ManyToMany( myUser, Group );
for ( group in joins ) {
	trace( group );
}
joins.add( someNewGroup );</code></pre>
<p>If in your models you specify a <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> property, the build macro will automatically take care of constructing the <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> object for you:</p>
<pre><code>// Please note the ordering of the two type parameters: you always do the current model first, the related model second.
class User {
	var groups:ManyToMany&lt;User,Group&gt;;
}
class Group {
	var users:ManyToMany&lt;Group,User&gt;;
}

function () {
	for ( group in myUser.groups ) {
trace( '$myUser is in the group $group' );
trace( 'The other people in that group are: '+group.users.join(", ") );
	}
}</code></pre>
<p>Please note that on the server, SQL queries are executed immediately - if you <code>this.<a href="#add">add</a>()</code> a related object, it will insert the join row immediately.
This means that all of your related objects must be saved and have a valid ID before you start creating joins.</p>
<p>When you first create a ManyToMany object, it will fetch the list of related objects if <code>initialise</code> is true.
If you're accessing the joins through a model's <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> property, the first time you call the getter it will fetch the list.</p>
<p>On the client, none of the SQL queries are executed, but the ManyToMany object can be serialized and shared between client and server.
This means you can serialize an object on the server with it's joins, and unserialize it on the client with the relationships in tact.
Making changes to the ManyToMany object on the client, such as adding another related object, will have no effect on the database.</p></div><h2>Class Fields</h2><div class="platform platform-project"><a name="createJoinTable"></a><h3><p><code><span class="keyword">static </span><span class="keyword">function</span> <a href="#createJoinTable"><span class="identifier">createJoinTable</span></a>(aModel:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../ufront/db/Object.html">Object</a>&gt;, bModel:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../ufront/db/Object.html">Object</a>&gt;):<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a join table for the two classes if it does not exist already.</p></div></div><div class="platform platform-project"><a name="generateTableName"></a><h3><p><code><span class="keyword">static </span><span class="keyword">function</span> <a href="#generateTableName"><span class="identifier">generateTableName</span></a>(a:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../Dynamic.html">Dynamic</a>&gt;, b:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../Dynamic.html">Dynamic</a>&gt;):<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p>Generate the table name used to join these two classes.</p></div></div><div class="platform platform-project"><a name="relatedIDsforObjects"></a><h3><p><code><span class="keyword">static </span><span class="keyword">function</span> <a href="#relatedIDsforObjects"><span class="identifier">relatedIDsforObjects</span></a>(aModel:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../ufront/db/Object.html">Object</a>&gt;, bModel:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../ufront/db/Object.html">Object</a>&gt;, ?aObjectIDs:<a class="type" href="../../Iterable.html">Iterable</a>&lt;<a class="type" href="../../sys/db/SUId.html">SUId</a>&gt; = null):<a class="type" href="../../haxe/ds/IntMap.html">IntMap</a>&lt;<a class="type" href="../../List.html">List</a>&lt;<a class="type" href="../../Int.html">Int</a>&gt;&gt;</code></p></h3><div class="doc"><p>A function to at once retrieve the related IDs of several objects.</p>
<pre><code>@param aModel The model for the object IDs you have
@param bModel The model the the related object IDs you want to fetch
@param aObjectIDs The specific models you want to get.  If not supplied, we'll get a map of ALL manyToMany relationships between these two models.
@return An IntMap, where the key is aObjectID, and the value is a list of related bObjectIDs
</code></pre></div></div><h2>Instance Fields</h2><div class="platform platform-project"><a name="length"></a><h3><p><code><span class="keyword">var</span> <a href="#length"><span class="identifier">length</span></a>:<a class="type" href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>The number of related objects.</p></div></div><div class="platform platform-project"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>(aObject:<span class="type">A</span>, bClass:<a class="type" href="../../Class.html">Class</a>&lt;<span class="type">B</span>&gt;, ?initialise:<a class="type" href="../../Bool.html">Bool</a> = true):<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a new <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a></code> object for managing related objects between <code>aObject</code> and <code>bClass</code>.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>aObject</td><td><ul><li>The current object. If <code>aObject</code> is null an exception will be thrown.</li></ul></td></tr><tr><td>bClass</td><td><ul><li>The model of related objects you are joining with.</li></ul></td></tr><tr><td>initialise</td><td><ul><li>Whether to fetch the current list of related objects immediately (server only, default is true).</li></ul></td></tr></tbody></table></div></div><div class="platform platform-project"><a name="add"></a><h3><p><code><span class="keyword">function</span> <a href="#add"><span class="identifier">add</span></a>(bObject:<span class="type">B</span>):<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Add a related object by creating a new Relationship on the appropriate join table.
If either aObject or bObject have no ID, we will add them to our local list, and they will be updated when saving.
If the object already has a relationship in the join table, it will be ignored.</p></div></div><div class="platform platform-project"><a name="clear"></a><h3><p><code><span class="keyword">function</span> <a href="#clear"><span class="identifier">clear</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Remove all relationships between our <code>aObject</code> and any <code>bObjects</code>.
If our <code>aObject</code> has no id, then no database call will be made.</p></div></div><div class="platform platform-project"><a name="commitJoins"></a><h3><p><code><span class="keyword">function</span> <a href="#commitJoins"><span class="identifier">commitJoins</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Resolves any differences between the joins represented here and the joins in the database.</p>
<pre><code>Most actions (`add`, `remove`, `setList` etc) apply to the database immediately if a) we're on the server and b) both objects have an ID.
If one of the joint objects is unsaved, or if we're on the client, then we might have a situation where our list here is out of sync with our list on the server.
Calling this will add or remove joins from the database to match our current state.
Please note if some of your objects are *still* unsaved, they will still remain unsaved.
</code></pre></div></div><div class="platform platform-project"><a name="filter"></a><h3><p><code><span class="keyword">function</span> <a href="#filter"><span class="identifier">filter</span></a>(predicate:<span class="type">B</span> -&gt;<a class="type" href="../../Bool.html">Bool</a>):<a class="type" href="../../List.html">List</a>&lt;<span class="type">B</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="first"></a><h3><p><code><span class="keyword">function</span> <a href="#first"><span class="identifier">first</span></a>():<a class="type" href="../../Null.html">Null</a>&lt;<span class="type">B</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="isEmpty"></a><h3><p><code><span class="keyword">function</span> <a href="#isEmpty"><span class="identifier">isEmpty</span></a>():<a class="type" href="../../Bool.html">Bool</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="iterator"></a><h3><p><code><span class="keyword">function</span> <a href="#iterator"><span class="identifier">iterator</span></a>():<a class="type" href="../../Iterator.html">Iterator</a>&lt;<span class="type">B</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="join"></a><h3><p><code><span class="keyword">function</span> <a href="#join"><span class="identifier">join</span></a>(sep:<a class="type" href="../../String.html">String</a>):<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="last"></a><h3><p><code><span class="keyword">function</span> <a href="#last"><span class="identifier">last</span></a>():<a class="type" href="../../Null.html">Null</a>&lt;<span class="type">B</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="map"></a><h3><p><code><span class="keyword">function</span> <a href="#map"><span class="identifier">map</span></a>(fn:<span class="type">B</span> -&gt;Unknown):<a class="type" href="../../List.html">List</a>&lt;Unknown&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-project"><a name="refreshList"></a><h3><p><code><span class="keyword">function</span> <a href="#refreshList"><span class="identifier">refreshList</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Fetch the related objects from the database.</p>
<pre><code>If `aObject` does not have an ID, then it will just have an empty list for now.
Any outstanding operations (`add` or `remove` operations that have not yet been committed to the database) will be lost.
</code></pre></div></div><div class="platform platform-project"><a name="remove"></a><h3><p><code><span class="keyword">function</span> <a href="#remove"><span class="identifier">remove</span></a>(bObject:<span class="type">B</span>):<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Remove the relationship/join between our <code>aObject</code> and a particular <code>bObject</code>.</p>
<p>If <code>bObject</code> is null this will have no effect.
If <code>aObject</code> or <code>bObject</code> have no ID, then the <code>bObject</code> will be removed from the local list, but no database query will be executed.</p></div></div><div class="platform platform-project"><a name="setList"></a><h3><p><code><span class="keyword">function</span> <a href="#setList"><span class="identifier">setList</span></a>(newBList:<a class="type" href="../../Iterable.html">Iterable</a>&lt;<span class="type">B</span>&gt;):<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Set the list of related B objects.
Any objects that were not previously related will have a relationship added with <code>this.<a href="#add">add</a>()</code>
Any objects that were previously related and are in <code>newBList</code> will not be affected.
Any objects that were previously related and are not in <code>newBList</code> will have <code>this.<a href="#remove">remove</a>()</code> called so they are no longer related.</p></div></div><div class="platform platform-project"><a name="toString"></a><h3><p><code><span class="keyword">function</span> <a href="#toString"><span class="identifier">toString</span></a>():<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p></p></div></div></div></div></div></body></html>