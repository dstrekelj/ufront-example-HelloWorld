<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../bootstrap.min.js"></script><link href="../../styles.css" rel="stylesheet" /><link rel="icon" href="../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../nav.js"></script><script type="text/javascript" src="../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../",platforms: ["dox"]};</script><title>Object</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="dox"><a href="#">dox</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><h1><code><span class="directive">class </span><span class="type">ufront.db.Object</span><span class="keyword"> extends</span> <a class="type" href="../../sys/db/Object.html">Object</a></code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div><table class="related-types toggle" style="margin-top:16px;"><tbody><tr><td colspan="2"><strong>Sub classes</strong></td></tr><tr><td width="12" style="vertical-align:top;"><a href="#" onclick="toggleInherited(this)"><img style="padding-top:4px;" src="../../triangle-closed.png"></img></a></td><td class="toggle-hide"><a href="../../ufront/auth/model/Group.html">Group</a>, <a href="../../ufront/auth/model/Permission.html">Permission</a>, <a href="../../ufront/auth/model/User.html">User</a>, <a href="../../ufront/db/Relationship.html">Relationship</a></td><td class="toggle-show"><table class="table table-condensed"><tbody><tr><td width="200"><a href="../../ufront/auth/model/Group.html">Group</a></td><td><p></p></td></tr><tr><td width="200"><a href="../../ufront/auth/model/Permission.html">Permission</a></td><td><p></p></td></tr><tr><td width="200"><a href="../../ufront/auth/model/User.html">User</a></td><td><p></p></td></tr><tr><td width="200"><a href="../../ufront/db/Relationship.html">Relationship</a></td><td><p></p></td></tr></tbody></table></td></tr></tbody></table></div><div class="doc"><p>Ufront DB Objects</p>
<p>This is the base class for models in Ufront's "Model, View, Controller" pattern.</p>
<p>Each model extends <code><a href="../../ufront/db/Object.html">ufront.db.Object</a></code>, and uses simple fields to describe what kind of data each of these objects will contain, and how that is saved to the database.
The type of each variable matches the type used in the database.</p>
<p>On the server, this class extends <code><a href="../../sys/db/Object.html">sys.db.Object</a></code> and adds:</p><ul><li>a default unique <code>this.<a href="#id">id</a></code> field (<code><a href="../../sys/db/SUId.html">SUId</a></code>, unsigned auto-incrementing integer)</li><li>a <code>this.<a href="#created">created</a></code> timestamp (<code><a href="../../sys/db/SDateTime.html">SDateTime</a></code>)</li><li>a <code>this.<a href="#modified">modified</a></code> timestamps (<code><a href="../../sys/db/SDateTime.html">SDateTime</a></code>)</li><li>modified <code>this.<a href="#insert">insert</a>()</code> and <code>this.<a href="#update">update</a>()</code> methods that check validation and updates <code>this.<a href="#created">created</a></code> and <code>this.<a href="#modified">modified</a></code> timestamps</li><li>a <code>this.<a href="#save">save</a>()</code> method that performs either <code>this.<a href="#insert">insert</a>()</code> or <code>this.<a href="#update">update</a>()</code></li><li>a <code>this.<a href="#validate">validate</a>()</code> method that checks if the object is valid. This method is filled out with validation rules by a build macro.</li><li>a <code>this.<a href="#validationErrors">validationErrors</a></code> property to check which errors were found in validation.</li><li>macro powered <code>this.<a href="#hxSerialize">hxSerialize</a>()</code> and <code>this.<a href="#hxUnserialize">hxUnserialize</a>()</code> methods to ensure these objects serialize and unserialize nicely.</li><li>a default <code>this.<a href="#toString">toString</a>()</code> method that provides "${modelName}#${id}" eg "Person#23"</li><li>a <code>save</code> signal</li></ul>
<p>On the client, this <em>does not</em> longer extends <code><a href="../../sys/db/Object.html">sys.db.Object</a></code>, so you can interact with your models even on targets that don't have access to the <code>sys.db</code> APIs - for example, Javascript in the browser.</p>
<p>This means that:</p><ul><li>Client side code can create, edit, and validate the objects.</li><li>You can send objects back and forward using Haxe remoting, for example saving an object to the server, or retrieving a list from the server.</li><li>When you unpack the object on the client it is fully typed, and you get full code re-use between client and server.</li><li>They just can't save them back to the database, because you can't connect to (for example) MySQL directly.</li><li>There is the experimental <code>ClientDS</code> library which allows you to save back to the server asynchronously using a remoting API.</li></ul>
<p>You should use <code>-D server</code> or <code>-D client</code> defines in your hxml build file to help ufront know whether we're compiling for the server or client.</p>
<p>Build macro effects:</p><ul><li>Process <code><a href="../../ufront/db/BelongsTo.html">BelongsTo</a>&lt;T&gt;</code>, <code><a href="../../ufront/db/HasMany.html">HasMany</a>&lt;T&gt;</code>, <code><a href="../../ufront/db/HasOne.html">HasOne</a>&lt;T&gt;</code> and <code><a href="../../ufront/db/ManyToMany.html">ManyToMany</a>&lt;A,B&gt;</code> relationships and create the appropriate getters and setters.</li><li>Add the appropriate validation checks to our <code>this.<a href="#validate">validate</a>()</code> method.</li><li>Save appropriate metadata for being able to serialize and unserialize correctly.</li><li>On the server, create a <code>public static var manager:<a href="../../sys/db/Manager.html">Manager</a>&lt;T&gt; = new <a href="../../sys/db/Manager.html">Manager</a>(T)</code> property for each class.</li><li>On the client, if using ClientDS, create a <code>public static var clientDS:ClientDS&lt;T&gt;</code> property for each class.</li></ul></div><h2>Instance Fields</h2><div class="platform platform-dox"><a name="created"></a><h3><p><code><span class="keyword">var</span> <a href="#created"><span class="identifier">created</span></a>:<a class="type" href="../../sys/db/SDateTime.html">SDateTime</a></code></p></h3><div class="doc"><p>The time this record was first created.</p></div></div><div class="platform platform-dox"><a name="id"></a><h3><p><code><span class="keyword">var</span> <a href="#id"><span class="identifier">id</span></a>:<a class="type" href="../../sys/db/SId.html">SId</a></code></p></h3><div class="doc"><p>A default ID. Auto-incrementing 32-bit Int.</p></div></div><div class="platform platform-dox"><a name="modified"></a><h3><p><code><span class="keyword">var</span> <a href="#modified"><span class="identifier">modified</span></a>:<a class="type" href="../../sys/db/SDateTime.html">SDateTime</a></code></p></h3><div class="doc"><p>The time this record was last modified.</p></div></div><div class="platform platform-dox"><a name="saved"></a><h3><p><code><span class="keyword">var</span> <a href="#saved"><span class="identifier">saved</span></a>:<a class="type" href="../../tink/Signal.html">Signal</a>&lt;<a class="type" href="../../tink/Noise.html">Noise</a>&gt;</code></p></h3><div class="doc"><p>A signal that is triggered after a successful save.</p></div></div><div class="platform platform-dox"><a name="validationErrors"></a><h3><p><code><span class="keyword">var</span> <a href="#validationErrors"><span class="identifier">validationErrors</span></a>:<a class="type" href="../../ufront/db/ValidationErrors.html">ValidationErrors</a></code></p></h3><div class="doc"><p>If a call to validate() fails, it will populate this map with a list of errors.  The key should
be the name of the field that failed validation, and the values should be a description of any errors.</p></div></div><div class="platform platform-dox"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-dox"><a name="insert"></a><h3><p><code><span class="keyword">function</span> <a href="#insert"><span class="identifier">insert</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Inserts a new record to the database.</p>
<pre><code>Will throw an error if `this.validate()` fails.
Updates the "created" and "modified" timestamps before saving.
</code></pre></div></div><div class="platform platform-dox"><a name="refresh"></a><h3><p><code><span class="keyword">function</span> <a href="#refresh"><span class="identifier">refresh</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Refresh the relations on this object.</p>
<pre><code>Currently this does not refresh the object itself, it merely empties the cached related objects so they will be fetched again.
In future we might get this to refresh the object itself from the database.
</code></pre></div></div><div class="platform platform-dox"><a name="save"></a><h3><p><code><span class="keyword">function</span> <a href="#save"><span class="identifier">save</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Save a record (either inserting or updating) to the database.</p>
<pre><code>If `id` is null, then it needs to be inserted.
If `id` already exists, try to update first.
If that throws an error, it means that it is not inserted yet, so then insert it.
Updates the "created" and "modified" timestamps as required.
</code></pre></div></div><div class="platform platform-dox"><a name="toString"></a><h3><p><code><span class="keyword">function</span> <a href="#toString"><span class="identifier">toString</span></a>():<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p></p></div></div><div class="platform platform-dox"><a name="update"></a><h3><p><code><span class="keyword">function</span> <a href="#update"><span class="identifier">update</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Updates an existing record in the database.</p>
<pre><code>Will throw an error if `this.validate()` fails.
Updates the "modified" timestamp before saving.
</code></pre></div></div><div class="platform platform-dox"><a name="validate"></a><h3><p><code><span class="keyword">function</span> <a href="#validate"><span class="identifier">validate</span></a>():<a class="type" href="../../Bool.html">Bool</a></code></p></h3><div class="doc"><p>A function to validate the current model.</p>
<p>By default, this checks that no values are null unless they are Null<T> / SNull<T>, or if it the unique ID
that will be automatically generated.  If any are null when they shouldn't be, the model fails to validate.</p>
<p>It also looks for "validate_{fieldName}" functions, and if they match, it executes the function.  If the function
throws an error or returns false, then validation will fail.</p>
<p>If you override this method to add more custom validation, then we recommend starting with <code>super.validate()</code> and
ending with <code>return validationErrors.isValid;</code></p></div></div></div></div></div></body></html>