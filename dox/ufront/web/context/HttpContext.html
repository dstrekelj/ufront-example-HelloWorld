<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../../bootstrap.min.js"></script><link href="../../../styles.css" rel="stylesheet" /><link rel="icon" href="../../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../../nav.js"></script><script type="text/javascript" src="../../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../../",platforms: ["dox"]};</script><title>HttpContext</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="dox"><a href="#">dox</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><h1><code><span class="directive">class </span><span class="type">ufront.web.context.HttpContext</span></code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div class="doc"><p>A context describing the current Http request, response and session.</p></div><h2>Class Fields</h2><div class="platform platform-dox"><a name="createSysContext"></a><h3><p><code><span class="keyword">static </span><span class="keyword">function</span> <a href="#createSysContext"><span class="identifier">createSysContext</span></a>(?request:<a class="type" href="../../../ufront/web/context/HttpRequest.html">HttpRequest</a> = null, ?response:<a class="type" href="../../../ufront/web/context/HttpResponse.html">HttpResponse</a> = null, ?appInjector:<a class="type" href="../../../minject/Injector.html">Injector</a> = null, ?session:<a class="type" href="../../../ufront/web/session/UFHttpSession.html">UFHttpSession</a> = null, ?auth:<a class="type" href="../../../ufront/auth/UFAuthHandler.html">UFAuthHandler</a>&lt;<a class="type" href="../../../ufront/auth/UFAuthUser.html">UFAuthUser</a>&gt; = null, ?urlFilters:<a class="type" href="../../../Array.html">Array</a>&lt;<a class="type" href="../../../ufront/web/url/filter/UFUrlFilter.html">UFUrlFilter</a>&gt; = null, ?relativeContentDir:<a class="type" href="../../../String.html">String</a> = 'uf-content'):<a class="type" href="../../../ufront/web/context/HttpContext.html">HttpContext</a></code></p></h3><div class="doc"><p>Create a HttpContext for Neko or PHP environments.</p>
<pre><code>If request and response are not supplied, they will created.
The rest of the parameters are passed directly to the `HttpContext` constructor.
</code></pre></div></div><h2>Instance Fields</h2><div class="platform platform-dox"><a name="actionContext"></a><h3><p><code><span class="keyword">var</span> <a href="#actionContext"><span class="identifier">actionContext</span></a>:<a class="type" href="../../../ufront/web/context/ActionContext.html">ActionContext</a></code></p></h3><div class="doc"><p>The <code><a href="../../../ufront/web/context/ActionContext.html">ActionContext</a></code> used in processing the request. Will be null until the application has found a handler for the request.</p></div></div><div class="platform platform-dox"><a name="auth"></a><h3><p><code><span class="keyword">var</span> <a href="#auth"><span class="identifier">auth</span></a>:<a class="type" href="../../../ufront/auth/UFAuthHandler.html">UFAuthHandler</a>&lt;<a class="type" href="../../../ufront/auth/UFAuthUser.html">UFAuthUser</a>&gt;</code></p></h3><div class="doc"><p>The current auth handler.
Either set during the constructor or created via dependency injection.</p></div></div><div class="platform platform-dox"><a name="completion"></a><h3><p><code><span class="keyword">var</span> <a href="#completion"><span class="identifier">completion</span></a>:<a class="type" href="../../../haxe/EnumFlags.html">EnumFlags</a>&lt;<a class="type" href="../../../ufront/web/context/RequestCompletion.html">RequestCompletion</a>&gt;</code></p></h3><div class="doc"><p>The completion progress of the current request. Setting these values will affect the flow of the request.</p>
<p>For example, if a middleware restores a response from a cached entry matching the current request, it may want to skip the <code>RequestHandler</code> and any <code>ResponseMiddleware</code>:</p>
<pre><code>// Skip remaining request middleware, and the request handler (this will then skip to the response middleware)
ctx.completion.set( CRequestMiddlewareComplete );
ctx.completion.set( CRequestHandlerComplete );</code></pre>
<p>Another example is if you have a controller or some code that writes directly to the output, not the response object, in which case you want to skip the log, flush, middleware etc.  (This is the case with the <code>dbadmin</code> tool)</p>
<pre><code>ctx.completion.set( CRequestHandlerComplete );
ctx.completion.set( CResponseMiddlewareComplete );
ctx.completion.set( CLogComplete );
ctx.completion.set( CFlushComplete );</code></pre>
<p>These values are updated by HttpApplication and various middleware and handlers, or you can update them manually.</p></div></div><div class="platform platform-dox"><a name="contentDirectory"></a><h3><p><code><span class="keyword">var</span> <a href="#contentDirectory"><span class="identifier">contentDirectory</span></a>:<a class="type" href="../../../String.html">String</a></code></p></h3><div class="doc"><p>Get the path of the content directory.</p>
<p>This is a directory that ufront has write-access to, and should preferably not be available for general Http access.</p>
<p>It can be used to store sessions, log files, cache, uploaded files etc.</p>
<p>The value is essentially <code>${request.scriptDirectory}/$relativeContentDir/</code>, where <code>relativeContentDir</code> is the value that was supplied to the constructor.</p>
<p>If using <code>ufront.application.UfrontApplication</code>, this value can be set with the <code>contentDirectory</code> setting in your <code>ufront.web.Configuration</code> initialization settings.</p>
<p>The trailing slash is always included.</p></div></div><div class="platform platform-dox"><a name="currentUser"></a><h3><p><code><span class="keyword">var</span> <a href="#currentUser"><span class="identifier">currentUser</span></a>:<a class="type" href="../../../Null.html">Null</a>&lt;<a class="type" href="../../../ufront/auth/UFAuthUser.html">UFAuthUser</a>&gt;</code></p></h3><div class="doc"><p>The current user.</p>
<p>This is a shortcut for <code>auth.currentUser</code>, but will return null if <code>auth</code> is null.</p></div></div><div class="platform platform-dox"><a name="currentUserID"></a><h3><p><code><span class="keyword">var</span> <a href="#currentUserID"><span class="identifier">currentUserID</span></a>:<a class="type" href="../../../Null.html">Null</a>&lt;<a class="type" href="../../../String.html">String</a>&gt;</code></p></h3><div class="doc"><p>The current user.</p>
<p>This is a shortcut for <code>auth.currentUser.id</code>, but will return null if <code>auth</code> or <code>auth.currentUser</code> is null.</p></div></div><div class="platform platform-dox"><a name="injector"></a><h3><p><code><span class="keyword">var</span> <a href="#injector"><span class="identifier">injector</span></a>:<a class="type" href="../../../minject/Injector.html">Injector</a></code></p></h3><div class="doc"><p>An dependency injector for the current request.</p>
<p>By default, mappings are provided for the following classes:</p><ul><li><code><a href="../../../ufront/web/context/HttpContext.html">ufront.web.context.HttpContext</a></code></li><li><code><a href="../../../ufront/web/context/HttpRequest.html">ufront.web.context.HttpRequest</a></code></li><li><code><a href="../../../ufront/web/context/HttpResponse.html">ufront.web.context.HttpResponse</a></code></li><li><code><a href="../../../ufront/web/context/ActionContext.html">ufront.web.context.ActionContext</a></code></li><li><code><a href="../../../ufront/log/MessageList.html">ufront.log.MessageList</a></code></li><li><code><a href="../../../ufront/web/session/UFHttpSession.html">ufront.web.session.UFHttpSession</a></code> (and the implementation class used for the session).</li><li><code><a href="../../../ufront/auth/UFAuthHandler.html">ufront.auth.UFAuthHandler</a></code> (and the implementation class used for the auth handler).</li></ul>
<p>When used in a HttpApplication, each call to <code>execute</code> will set the application's injector as this context's parent injector.
This means all mappings at the application level will be available in the request injector.</p></div></div><div class="platform platform-dox"><a name="messages"></a><h3><p><code><span class="keyword">var</span> <a href="#messages"><span class="identifier">messages</span></a>:<a class="type" href="../../../Array.html">Array</a>&lt;<a class="type" href="../../../ufront/log/Message.html">Message</a>&gt;</code></p></h3><div class="doc"><p>A collection of messages that were traced during this request.</p></div></div><div class="platform platform-dox"><a name="request"></a><h3><p><code><span class="keyword">var</span> <a href="#request"><span class="identifier">request</span></a>:<a class="type" href="../../../ufront/web/context/HttpRequest.html">HttpRequest</a></code></p></h3><div class="doc"><p>The current HttpRequest</p></div></div><div class="platform platform-dox"><a name="response"></a><h3><p><code><span class="keyword">var</span> <a href="#response"><span class="identifier">response</span></a>:<a class="type" href="../../../ufront/web/context/HttpResponse.html">HttpResponse</a></code></p></h3><div class="doc"><p>The current HttpResponse</p></div></div><div class="platform platform-dox"><a name="session"></a><h3><p><code><span class="keyword">var</span> <a href="#session"><span class="identifier">session</span></a>:<a class="type" href="../../../ufront/web/session/UFHttpSession.html">UFHttpSession</a></code></p></h3><div class="doc"><p>The current session.
Either set during the constructor or created via dependency injection.</p></div></div><div class="platform platform-dox"><a name="sessionID"></a><h3><p><code><span class="keyword">var</span> <a href="#sessionID"><span class="identifier">sessionID</span></a>:<a class="type" href="../../../Null.html">Null</a>&lt;<a class="type" href="../../../String.html">String</a>&gt;</code></p></h3><div class="doc"><p>The current session ID.</p>
<p>This is a shortcut for <code>session.id</code>, but will return null if <code>session</code> is null.</p></div></div><div class="platform platform-dox"><a name="urlFilters"></a><h3><p><code><span class="keyword">var</span> <a href="#urlFilters"><span class="identifier">urlFilters</span></a>:<a class="type" href="../../../Iterable.html">Iterable</a>&lt;<a class="type" href="../../../ufront/web/url/filter/UFUrlFilter.html">UFUrlFilter</a>&gt;</code></p></h3><div class="doc"><p>The URL filters to be used for <code>getRequestUri()</code> and <code>generateUri()</code></p></div></div><div class="platform platform-dox"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>(request:<a class="type" href="../../../ufront/web/context/HttpRequest.html">HttpRequest</a>, response:<a class="type" href="../../../ufront/web/context/HttpResponse.html">HttpResponse</a>, ?appInjector:<a class="type" href="../../../minject/Injector.html">Injector</a> = null, ?session:<a class="type" href="../../../ufront/web/session/UFHttpSession.html">UFHttpSession</a> = null, ?auth:<a class="type" href="../../../ufront/auth/UFAuthHandler.html">UFAuthHandler</a>&lt;<a class="type" href="../../../ufront/auth/UFAuthUser.html">UFAuthUser</a>&gt; = null, ?urlFilters:<a class="type" href="../../../Array.html">Array</a>&lt;<a class="type" href="../../../ufront/web/url/filter/UFUrlFilter.html">UFUrlFilter</a>&gt; = null, ?relativeContentDir:<a class="type" href="../../../String.html">String</a> = 'uf-content'):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a HttpContext object using the explicitly supplied objects.</p>
<p>For creating a context for each platform see <code>createSysContext</code> and <code>createNodeJSContext</code>.</p><table class="table table-condensed"><tbody><col width="10%"/>  <col width="100%"/><tr><td>request</td><td><p>(required) The current <code><a href="../../../ufront/web/context/HttpRequest.html">HttpRequest</a></code>.</p></td></tr><tr><td>response</td><td><p>(required) The current <code><a href="../../../ufront/web/context/HttpResponse.html">HttpResponse</a></code>.</p></td></tr><tr><td>appInjector</td><td><p>(optional) The HttpApplication injector, which will be the parent injector for this request - all appInjector mappings will be shared with this context's injector. If null no parent injector will be used.</p></td></tr><tr><td>session</td><td><p>(optional) The current session. If null, we will attempt to get a <code><a href="../../../ufront/web/session/UFHttpSession.html">UFHttpSession</a></code> from the injector. If that fails, we will use a <code><a href="../../../ufront/web/session/VoidSession.html">VoidSession</a></code>.</p></td></tr><tr><td>auth</td><td><p>(optional) The current authentication handler. If null, we will attempt to get a <code><a href="../../../ufront/auth/UFAuthHandler.html">UFAuthHandler</a></code> from the injector. If that fails, we will use a <code><a href="../../../ufront/auth/NobodyAuthHandler.html">NobodyAuthHandler</a></code>, which is appropriate for a visitor who has no permissions.</p></td></tr><tr><td>urlFilters</td><td><p>(optional) The URL Filters to use on the current request. If null, an empty array (no filters) will be used.</p></td></tr><tr><td>relativeContentDir</td><td><p>(optional) The path to the content directory, relative to the script directory. Default is "uf-content".</p></td></tr></tbody></table></div></div><div class="platform platform-dox"><a name="commitSession"></a><h3><p><code><span class="keyword">function</span> <a href="#commitSession"><span class="identifier">commitSession</span></a>():<a class="type" href="../../../tink/Surprise.html">Surprise</a>&lt;<a class="type" href="../../../tink/Noise.html">Noise</a>, <a class="type" href="../../../String.html">String</a>&gt;</code></p></h3><div class="doc"><p>Commit the session data, if there is any.</p>
<p>Will return a future letting you know when the session commit has been completed</p></div></div><div class="platform platform-dox"><a name="generateUri"></a><h3><p><code><span class="keyword">function</span> <a href="#generateUri"><span class="identifier">generateUri</span></a>(uri:<a class="type" href="../../../String.html">String</a>):<a class="type" href="../../../String.html">String</a></code></p></h3><div class="doc"><p>Takes a URI and runs it through the given filters in reverse.</p>
<p>For example, if you use <code><a href="../../../ufront/web/url/filter/PathInfoUrlFilter.html">PathInfoUrlFilter</a></code> this could turn <code>/home/</code> into <code>index.n?path=/home/</code>.
This is useful so your code contains the simple URIs, but at runtime they are transformed into the correct form depending on the environment.</p></div></div><div class="platform platform-dox"><a name="getRequestUri"></a><h3><p><code><span class="keyword">function</span> <a href="#getRequestUri"><span class="identifier">getRequestUri</span></a>():<a class="type" href="../../../String.html">String</a></code></p></h3><div class="doc"><p>Gets the filtered request URI.</p>
<p>It uses the request uri found in the supplied <code><a href="../../../ufront/web/context/HttpRequest.html">HttpRequest</a></code>, but applies the Url Filters to it.
For example, if you use <code><a href="../../../ufront/web/url/filter/PathInfoUrlFilter.html">PathInfoUrlFilter</a></code> to filter <code>index.n?path=/home/</code> into <code>/home/</code>, this will return the filtered result.</p></div></div><div class="platform platform-dox"><a name="setUrlFilters"></a><h3><p><code><span class="keyword">function</span> <a href="#setUrlFilters"><span class="identifier">setUrlFilters</span></a>(filters:<a class="type" href="../../../Iterable.html">Iterable</a>&lt;<a class="type" href="../../../ufront/web/url/filter/UFUrlFilter.html">UFUrlFilter</a>&gt;):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>Sets the URL filters.  Should only be used before the request has begun processing.</p></div></div><div class="platform platform-dox"><a name="ufError"></a><h3><p><code><span class="keyword">function</span> <a href="#ufError"><span class="identifier">ufError</span></a>(msg:<a class="type" href="../../../Dynamic.html">Dynamic</a>, ?pos:<a class="type" href="../../../haxe/PosInfos.html">PosInfos</a> = null):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a Error message on the current request.</p>
<p>Similar to ufTrace, except that the message is noted to be a Error, which may be displayed differently by the tracing module.</p>
<p>Please note this does not throw or catch errors, it merely outputs a message to the log and marks that message as an error.
It may be sensible to use it in your error handling code, but not <em>as</em> your error handling code.</p></div></div><div class="platform platform-dox"><a name="ufLog"></a><h3><p><code><span class="keyword">function</span> <a href="#ufLog"><span class="identifier">ufLog</span></a>(msg:<a class="type" href="../../../Dynamic.html">Dynamic</a>, ?pos:<a class="type" href="../../../haxe/PosInfos.html">PosInfos</a> = null):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a Log message on the current request.</p>
<p>Similar to ufTrace, except that the message is noted to be a Log, which may be displayed differently by the tracing module.</p></div></div><div class="platform platform-dox"><a name="ufTrace"></a><h3><p><code><span class="keyword">function</span> <a href="#ufTrace"><span class="identifier">ufTrace</span></a>(msg:<a class="type" href="../../../Dynamic.html">Dynamic</a>, ?pos:<a class="type" href="../../../haxe/PosInfos.html">PosInfos</a> = null):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>A trace statement that will be associated with this HttpContext</p>
<p>Because of the static nature of Haxe's <code>trace</code> (it always uses <code><a href="../../../haxe/Log.html#trace">haxe.Log.trace</a></code>, and that does not have access to information about our request), it can be hard to differentiate which traces belong to which requests.</p>
<p>A workaround is to call HttpContext's ufTrace(), store our messages here, and output them at the end of the request.  You can call <code>httpContext.ufTrace(someValue)</code> just like you would any other trace, and the traces will be displayed as normal at the end of the request.</p>
<p>Inline shortcuts are provided from <code><a href="../../../ufront/web/Controller.html">ufront.web.Controller</a></code> and <code><a href="../../../ufront/api/UFApi.html">ufront.api.UFApi</a></code> so that you can call ufTrace() and it points to this method.</p></div></div><div class="platform platform-dox"><a name="ufWarn"></a><h3><p><code><span class="keyword">function</span> <a href="#ufWarn"><span class="identifier">ufWarn</span></a>(msg:<a class="type" href="../../../Dynamic.html">Dynamic</a>, ?pos:<a class="type" href="../../../haxe/PosInfos.html">PosInfos</a> = null):<a class="type" href="../../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a Warning message on the current request.</p>
<p>Similar to ufTrace, except that the message is noted to be a Warning, which may be displayed differently by the tracing module.</p></div></div></div></div></div></body></html>