<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><link href="../../bootstrap-combined.min.css" rel="stylesheet" /><script type="text/javascript" src="../../jquery-1.9.1.min.js"></script><script type="text/javascript" src="../../bootstrap.min.js"></script><link href="../../styles.css" rel="stylesheet" /><link rel="icon" href="../../favicon.ico" type="image/x-icon"></link><script type="text/javascript" src="../../nav.js"></script><script type="text/javascript" src="../../index.js"></script><script type="text/javascript">var dox = {rootPath: "../../",platforms: ["project"]};</script><title>Controller</title></head><body><div class="navbar navbar-inverse navbar-fixed-top"><div class="navbar-inner"><form class="navbar-search pull-left" id="searchForm"><input id="search" type="text" class="search-query" placeholder="Filter" autocomplete="off"/></form><ul class="nav"><li id="select-platform" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform<b class="caret"></b></a><ul class="dropdown-menu"><li data="all"><a href="#">All Platforms</a></li><li data="project"><a href="#">project</a></li></ul></li></ul></div></div><div id="container"><div id="nav"></div><div id="content"><div class="header"><h1><code><span class="directive">class </span><span class="type">ufront.web.Controller</span></code></h1></div><div class="body"><p class="availability">Available on all platforms</p><div><table class="related-types toggle" style="margin-top:16px;"><tbody><tr><td colspan="2"><strong>Sub classes</strong></td></tr><tr><td width="12" style="vertical-align:top;"><a href="#" onclick="toggleInherited(this)"><img style="padding-top:4px;" src="../../triangle-closed.png"></img></a></td><td class="toggle-hide"><a href="../../app/Routes.html">Routes</a>, <a href="../../ufront/ufadmin/UFAdminModule.html">UFAdminModule</a>, <a href="../../ufront/web/DefaultUfrontController.html">DefaultUfrontController</a></td><td class="toggle-show"><table class="table table-condensed"><tbody><tr><td width="200"><a href="../../app/Routes.html">Routes</a></td><td><p>Handles URI routing.</p></td></tr><tr><td width="200"><a href="../../ufront/ufadmin/UFAdminModule.html">UFAdminModule</a></td><td><p>A base-class used to define a controller that can be used in the UFAdmin control panel.</p></td></tr><tr><td width="200"><a href="../../ufront/web/DefaultUfrontController.html">DefaultUfrontController</a></td><td><p>A simple controller to use if no other is specified.</p></td></tr></tbody></table></td></tr></tbody></table></div><div class="doc"><p>A base class for your controllers when using Ufront's MVC (Model View Controller) pattern.</p>
<p>A controller helps decide on the appropriate action to be taken given the route and parameters provided.
It then interacts with the site's API, and returns an <code><a href="../../ufront/web/result/ActionResult.html">ActionResult</a></code>, (or <code><a href="../../ufront/web/result/FutureActionResult.html">FutureActionResult</a></code>) which is used to write a response back to the client.</p>
<h4>The base controller provides:</h4><ul><li>A <code>this.<a href="#context">context</a></code> property holding the current <code><a href="../../ufront/web/context/HttpContext.html">HttpContext</a></code></li><li>An macro powered <code>this.<a href="#execute">execute</a>()</code> method which:</li><li>decides which method to execute as the "action" for this request based upon the URI and parameters,</li><li>from the URI and HTTP parameters, extract variables required for the chosen action,</li><li>return a <code><a href="../../tink/Surprise.html">Surprise</a></code>, that holds either an <code><a href="../../ufront/web/result/ActionResult.html">ActionResult</a></code> or an <code><a href="../../haxe/io/Error.html">Error</a></code>.</li><li>A <code>this.<a href="#executeSubController">executeSubController</a>()</code> method to create a sub controller, perform dependency injection, and execute it.</li><li>A <code>this.<a href="#baseUri">baseUri</a></code> property with the base URI for reaching this controller in your app's routing.</li><li>Shortcuts to <code>this.<a href="#ufTrace">ufTrace</a>()</code>, <code>this.<a href="#ufLog">ufLog</a>()</code>, <code>this.<a href="#ufWarn">ufWarn</a>()</code> and <code>this.<a href="#ufError">ufError</a>()</code> that can be used in your controller code.</li><li>A <code>this.<a href="#toString">toString</a>()</code> method that prints the current class name, helpful when logging or debugging.</li></ul>
<h4>How to set up routes:</h4>
<p>An "action" is a method of the controller that can be called by visiting a certain route.</p>
<p>You set up an action by defining function and giving it <code>@:route</code> metadata.</p>
<p>Here are some examples:</p><ul><li><code>@:route('/') function homepage() {}</code></li><li><code>@:route('/staff/') function staff() {}</code></li><li><code>@:route('/staff/$name/') function viewPerson( name:<a href="../../String.html">String</a> ) {}</code></li><li><code>@:route('/staff/$name/contact/',GET) function contact( name:<a href="../../String.html">String</a> ) {}</code></li><li><code>@:route('/staff/$name/contact/',POST) function contact( name:<a href="../../String.html">String</a>, args:{ subject:<a href="../../String.html">String</a>, text:<a href="../../String.html">String</a> } ) {}</code></li><li><code>@:route('/article/$name/$page/') function article( name:<a href="../../String.html">String</a>, page:<a href="../../Int.html">Int</a> ) {}</code></li><li><code>@:route('/file/*') function viewFile( parts:<a href="../../Array.html">Array</a>&lt;<a href="../../String.html">String</a>&gt; ) {}</code></li><li><code>@:route('/ufadmin/*') var adminController:UFAdminHomeController; // Execute a sub controller at this route.</code></li></ul>
<h4>How to write output to the browser:</h4><ul><li>Each action must return a value</li><li>Possible return values are:</li><li><code><a href="../../tink/Surprise.html">Surprise</a>&lt;<a href="../../ufront/web/result/ActionResult.html">ActionResult</a>,<a href="../../tink/core/Error.html">tink.core.Error</a>&gt;</code></li><li><code><a href="../../tink/Surprise.html">Surprise</a>&lt;<a href="../../Dynamic.html">Dynamic</a>,<a href="../../Dynamic.html">Dynamic</a>&gt;</code></li><li><code><a href="../../tink/Future.html">Future</a>&lt;<a href="../../Dynamic.html">Dynamic</a>&gt;</code></li><li><code><a href="../../tink/Outcome.html">Outcome</a>&lt;<a href="../../ufront/web/result/ActionResult.html">ActionResult</a>,<a href="../../tink/core/Error.html">tink.core.Error</a>&gt;</code></li><li><code><a href="../../tink/Outcome.html">Outcome</a>&lt;<a href="../../Dynamic.html">Dynamic</a>,<a href="../../tink/core/Error.html">tink.core.Error</a>&gt;</code></li><li><code><a href="../../ufront/web/result/ActionResult.html">ActionResult</a></code></li><li><code><a href="../../Dynamic.html">Dynamic</a></code></li></ul>
<p>Each different return type will be handled by <code>this.<a href="#execute">execute</a>()</code>, and wrapped appropriately so that execute will always return a <code><a href="../../tink/Surprise.html">Surprise</a>&lt;<a href="../../ufront/web/result/ActionResult.html">ActionResult</a>,<a href="../../tink/core/Error.html">tink.core.Error</a>&gt;</code>.</p>
<p>Please note that if an exception is thrown in one of your actions, it will be caught and turned into an appropriate <code><a href="../../tink/core/Error.html">tink.core.Error</a></code> object to be handled by your application's error handlers.</p>
<h4>Build macro</h4>
<p>The <code>this.<a href="#execute">execute</a>()</code> method on this class is abstract, and should be overridden on each child class via a build macro customized especially for that class given the <code>@:route()</code> metadata.</p>
<p>The build macro will look for all methods with <code>@:route()</code> metadata, and create a giant if / else if / else statement:</p>
<pre><code>if ( uri=="/" ) return index();
else if ( uri=="/contact/" &amp;&amp; method=="GET" ) return contactForm();
else if ( uri=="/contact/" &amp;&amp; method=="POST" ) return sendContactEmail();
else throw HttpError.pageNotFound();</code></pre>
<p>Of course it gets more complicated as your routes become more complicated, but this basic structure stays the same.</p>
<p>The <code>this.<a href="#execute">execute</a>()</code> method will test each route in the order they are defined.
So if you have a wildcard route <code>@:route("/*")</code>  at the top of your class, and a specific route <code>@:route('/mypage/')</code> below it, the wildcard will match first and be called every time.</p>
<p>If the build macro encounters <code>@:route()</code> metadata on a variable rather than a method, it will:</p><ul><li>Check the given variable's type represents a Controller</li><li>Create a method: <code>function execute_$varName() return executeSubController(context);</code></li><li>Perform the routing on the generated function</li></ul>
<p>The build macro should not effect any existing fields other than <code>this.<a href="#execute">execute</a>()</code>.</p></div><h2>Instance Fields</h2><div class="platform platform-project"><a name="baseUri"></a><h3><p><code><span class="keyword">var</span> <a href="#baseUri"><span class="identifier">baseUri</span></a>:<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p>The Base URI that was used to access this controller.</p>
<p>This will always include a trailing slash.</p>
<p>For example if you had <code>/user/jason/profile/</code> trigger <code>UserController</code> (for Jason) and the <code>profile</code> action, then baseUrl would be <code>/user/jason/</code>.</p></div></div><div class="platform platform-project"><a name="context"></a><h3><p><code><span class="keyword">var</span> <a href="#context"><span class="identifier">context</span></a>:<a class="type" href="../../ufront/web/context/HttpContext.html">HttpContext</a></code></p></h3><div class="doc"><p>The current HttpContext.</p>
<p>This is set via dependency injection.</p>
<p>If you want to run some code after this has been injected, you can use for example: <code>@post public function doAuthCheck() { context.auth.requirePermission(AccessAdminArea); }</code>.</p></div></div><div class="platform platform-project"><a name="new"></a><h3><p><code><span class="keyword">function</span> <a href="#new"><span class="identifier">new</span></a>():<a class="type" href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Create a new <code><a href="../../ufront/web/Controller.html">Controller</a></code> instance.</p>
<p>Most of the time a controller will be created using dependency injection:</p>
<p>    <code>injector.instantiate( MyController )</code></p>
<p>If not creating a controller with <code>new MyController()</code> by sure to inject the dependencies (such as <code>context</code>) manually.</p></div></div><div class="platform platform-project"><a name="execute"></a><h3><p><code><span class="keyword">function</span> <a href="#execute"><span class="identifier">execute</span></a>():<a class="type" href="../../ufront/web/result/FutureActionOutcome.html">FutureActionOutcome</a></code></p></h3><div class="doc"><p>Execute the this controller with the current context.</p>
<p>This will anazlyze the URI and the current <code><a href="../../php/ufront/web/context/HttpRequest.html">HttpRequest</a></code>, and match it to the appropriate action using the <code>@:route()</code> metadata.</p>
<p>It will wrap the return result of your action in a <code><a href="../../tink/Surprise.html">Surprise</a>&lt;<a href="../../ufront/web/result/ActionResult.html">ActionResult</a>,<a href="../../tink/core/Error.html">tink.core.Error</a>&gt;</code>.</p>
<p>Please note this is an abstract method.
Each child class will have an override, provided by a build macro, that has the appropriate code for that class.</p></div></div><div class="platform platform-project"><a name="executeSubController"></a><h3><p><code><span class="keyword">function</span> <a href="#executeSubController"><span class="identifier">executeSubController</span></a>(controller:<a class="type" href="../../Class.html">Class</a>&lt;<a class="type" href="../../ufront/web/Controller.html">Controller</a>&gt;):<a class="type" href="../../ufront/web/result/FutureActionOutcome.html">FutureActionOutcome</a></code></p></h3><div class="doc"><p>Instantiate and execute a sub controller.</p></div></div><div class="platform platform-project"><a name="toString"></a><h3><p><code><span class="keyword">function</span> <a href="#toString"><span class="identifier">toString</span></a>():<a class="type" href="../../String.html">String</a></code></p></h3><div class="doc"><p>A default toString() that prints the current class name.</p></div></div></div></div></div></body></html>